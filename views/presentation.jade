!!! 5
html(lang='utf-8')
	head
		title='The 11th JCO'
		script(src='/socket.io/socket.io.js')
		script(src='http://code.jquery.com/jquery-1.6.1.min.js')
		script(type='text/javascript')
			$(function(){
				var socket = new io.Socket(null, {port: #{port}, rememberTransport:false});
				socket.connect();
				socket.send({'type':'subscribe', 'channel':'#{p_id}'});
				socket.on('message', function(obj){
					var message = obj.msg;
					console.log(obj);
					console.log('I got you: ' + message);
					$("#rt_feedbacks").append("<li>[" + message.from + "]님은 " + message.emotion + ' "' + message.body +  '"</li>');
					$("#comment").attr('value', '');
				});
				$('#send_comment').click(function(){
					var msg_body = $('#comment').val();
					var msg_emotion = $('#emotion :selected').val();
					socket.send({'type':'publish', 'channel':'#{p_id}', 'msg':{'body':msg_body, 'from':'#{username}', 'emotion':msg_emotion}});
					console.log(msg_body);
					console.log(msg_emotion);
				});
			});
	body
		h1 #{title}
		p feedbacks
		ul(id='rt_feedbacks')
		select(id='emotion')
			option(value='불만이 있습니다.') 불만입니다.
			option(value='다르게 생각합니다.') 이의있습니다.
			option(value='좋아합니다.', selected=true) 좋습니다.
			option(value='공감하고 있습니다.') 공감합니다.
			option(value='궁금해 합니다.') 궁금합니다.
		input(id='comment', name='comment', autocomplete='off', size='50')
		button(id='send_comment') Send
		div
			button(id='show_all_comment') 모두 보기
			ul(id='all_feedbacks')